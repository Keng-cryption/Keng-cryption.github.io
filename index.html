<div id="chat">
  <div id="chat-log" style="height:200px; overflow:auto; border:1px solid #ccc; padding:8px;"></div>
  <input id="chat-input" placeholder="Type a message..." style="width:70%;">
  <button onclick="sendMessage()">Send</button>
  <hr>
  <input id="screenshot-input" placeholder="Enter URL for screenshot" style="width:70%;">
  <button onclick="takeScreenshot()">Screenshot</button>
  <div id="screenshot-output" style="margin-top:10px;"></div>
</div>

<script type="module">
import { chatWithGPT, screenshotURL } from 'backend/chat';

async function sendMessage() {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  if (!message) return;
  input.value = "";

  // Show user message
  document.getElementById('chat-log').innerHTML += `<p><b>You:</b> ${message}</p>`;

  // Send to backend
  const result = await chatWithGPT(message);
  const reply = result.choices[0].message.content;
  document.getElementById('chat-log').innerHTML += `<p><b>Bot:</b> ${reply}</p>`;
}

async function takeScreenshot() {
  const url = document.getElementById('screenshot-input').value.trim();
  if (!url) return;

  document.getElementById('screenshot-output').innerHTML = "Loading screenshot...";

  try {
    const base64Image = await screenshotURL(url);
    document.getElementById('screenshot-output').innerHTML = `<img src="data:image/png;base64,${base64Image}" style="max-width:100%;">`;
  } catch (err) {
    document.getElementById('screenshot-output').innerHTML = "Failed to take screenshot.";
    console.error(err);
  }
}
</script>
